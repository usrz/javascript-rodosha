!function(exports,global){"use strict";global["true"]=exports,Esquire.define("rodosha/client",["$global","$esquire","rodosha/messages"],function(a,b,c){function d(a,b){if(b||(b=[]),"function"==typeof a)return{__$$invocable$$__:!0};if(a&&"object"==typeof a&&!Array.isArray(a)){if(b.indexOf(a)>=0)throw new TypeError("Unable to proxy object: circular reference detected");b.push(a);var c={};for(var e in a)c[e]=d(a[e],b);return b.pop(),c}return{__$$value$$__:a}}function e(a){if("object"==typeof a&&!Array.isArray(a)||"function"==typeof a){var b="proxy_"+ ++h;g[b]=a;var c=d(a);return{proxy:{id:b,definition:c}}}return{resolve:a}}function f(a){var b=a.data.id;if(null==b)throw new Error("No ID for message "+JSON.stringify(a.data));this.data=c.decode(a.data),this.id=this.data.id}var g={},h=0;return f.prototype.accept=function(b){if(b&&"function"==typeof b.then){var d=this;b.then(function(a){d.accept(a)},function(a){d.reject(a)})}else if(void 0===b)a.postMessage({id:this.id,resolve:!0,undefined:!0});else if(null===b)a.postMessage({id:this.id,resolve:!0,"null":!0});else{var f=this.data.makeProxy?e(b):{resolve:c.encode(b)};f.id=this.id,a.postMessage(f)}},f.prototype.reject=function(b){a.postMessage({id:this.id,reject:c.encode(b)})},Object.freeze({init:function(d){var e=a.console={error:function(){a.postMessage({console:"error",arguments:c.encode(arguments)})},warn:function(){a.postMessage({console:"warn",arguments:c.encode(arguments)})},log:function(){a.postMessage({console:"log",arguments:c.encode(arguments)})},info:function(){a.postMessage({console:"info",arguments:c.encode(arguments)})},debug:d?function(){a.postMessage({console:"debug",arguments:c.encode(arguments)})}:function(){},clear:function(){}};a.onmessage=function(c){var d=new f(c);d.foo&&e.log("FOO IS",d.foo);try{if(d.data.module){var h=d.data.module;Esquire.modules[h.name]?e.warn("Module '"+h.name+"' already defined"):(e.debug("Module '"+h.name+"' defined successfully"),Esquire.define(h)),d.accept(Esquire.module(h.name).name)}else if(d.data.require)d.accept(b.require(d.data.require));else if(d.data.proxy){var i=d.data.proxy,j=g,k=null,l=null;for(var m in i.proxy){var n=i.proxy[m];if(!(n in j))throw new Error("Proxy '"+i.proxy.join(".")+"' not found");k=j,l=n,j=j[n]}d.accept("function"==typeof j?j.apply(k,i.arguments):i.value?k[l]=i.value:j)}else if(d.data.destroy)d.data.destroy in g?(delete g[d.data.destroy],d.accept()):d.reject();else{if(!d.data.close)throw new Error("Usupported message: "+JSON.stringify(c.data));a.close(),d.accept()}}catch(o){d.reject(o)}},e.log("Initialized worker thread from "+a.location.href),a.postMessage({initialized:Object.keys(Esquire.modules)})}})}),Esquire.define("rodosha",["defers/Deferred","rodosha/servers","rodosha/workers"],function(a,b,c){function d(a,b){var c=Esquire.module(b);if(!c)throw new Error("Module '"+b+"' not found");a[c.name]=c;var d=Esquire.resolve(c,!0);for(var e in d){var f=d[e];f.$$dynamic||(a[f.name]=f)}return a}return Object.freeze({create:function(){for(var e=Math.floor(4294967296*Math.random()).toString(16);e.length<8;)e="0"+e;var f=new a,g=!1,h=arguments.length;arguments.length>0&&"boolean"==typeof arguments[arguments.length-1]&&(g=arguments[arguments.length-1],h-=1);for(var i=d({},"rodosha/client"),j=0;h>j;j++)i=d(i,arguments[j]);var k=[];k.push("("+Esquire.$$script+")(self);\n");for(var j in i)k.push(i[j].$$script+";\n");if(k.push("new Esquire().require('rodosha/client').init("+g+");\n"),g){var l=k.join("").split("\n");for(var j in l){var m=new Number(j)+1;m=10>m?"  "+m+" - ":100>m?" "+m+" - ":m+" - ",l[j]=m+l[j]}console.log("Worker["+e+"] Script\n"+l.join("\n"))}var n=b.create(c.makeWorker(k),e,g),o=Object.freeze({get modules(){return n.modules},"import":function(){return n["import"].apply(n,arguments)},proxy:function(){return n.proxy.apply(n,arguments)},destroy:function(){return n.destroy.apply(n,arguments)},close:function(){return n.close.apply(n,arguments)},terminate:function(){return n.terminate.apply(n,arguments)}});return n.worker.onerror=function(a){console.error("Worker["+e+"] Uncaught exception",a.data),f.reject(a)},n.worker.onmessage=function(a){if("initialized"in a.data)n.init(a.data.initialized),f.resolve(o);else try{n.received(a.data)}catch(b){console.error("Worker["+e+"] Exception processing message",a.data,b),console.error(b.stack)}},f.promise}})}),Esquire.define("rodosha/messages",[],function messages(){function RemoteError(a){var b=a.message||"Unknown error",c="RemoteError"+(a.name?"["+a.name+"]":"");Error.call(b),this.message=b,this.name=c,this.toString=function(){return c+": "+b};var d=this.stack||(new Error).stack;if(d&&(d=d.replace(/^(Remote)?Error\n/,"")),a.stack||d){var e=this.toString();a.stack&&(e+="\n- Remote stack:\n"+a.stack),d&&(e+="\n- Local stack:\n"+d),this.stack=e}}function copy(a,b,c,d){if(c.indexOf(a)>=0)throw new TypeError("Unable to (en|de)code object: circular reference detected");if(c.push(a),a.hasOwnProperty("callee")&&"number"==typeof a.length)for(var e=0;e<a.length;e++)b[e]=d(a[e],c);else for(var e in a)b[e]=d(a[e],c);return c.pop(),b}function encode(a,b){if(b||(b=[]),void 0===a)return void 0;if(null===a)return null;var c=typeof a;if("undefined"===c)return void 0;if("boolean"===c)return a;if("number"===c)return a;if("string"===c)return a;if("function"===c)return{__$$function$$__:a.toString()};if("object"===c){if(a instanceof ArrayBuffer)return a;if(a.buffer instanceof ArrayBuffer)return a;if(Array.isArray(a))return copy(a,[],b,encode);if(a.hasOwnProperty("callee")&&"number"==typeof arguments.length)return copy(a,[],b,encode);if(a instanceof Error){var d=a.name||Object.getPrototypeOf(a).name,e=a.message,b=a.stack,f={};return d&&(f.name=d),e&&(f.message=e),b&&(f.stack=b),{__$$error$$__:f}}return copy(a,{},b,encode)}return{__$$typeof$$__:c}}function decode(encoded,stack){if(stack||(stack=[]),void 0===encoded)return void 0;if(null===encoded)return null;var type=typeof encoded;if("undefined"===type)return void 0;if("boolean"===type)return encoded;if("number"===type)return encoded;if("string"===type)return encoded;if("object"===type)return encoded instanceof ArrayBuffer?encoded:encoded.buffer instanceof ArrayBuffer?encoded:Array.isArray(encoded)?copy(encoded,[],stack,decode):null!=encoded.__$$error$$__?new RemoteError(encoded.__$$error$$__):null!=encoded.__$$function$$__?eval("("+encoded.__$$function$$__+")"):copy(encoded,{},stack,decode);throw new TypeError("Error decoding "+type+": "+JSON.stringify(encoded))}return RemoteError.prototype=Object.create(Error.prototype),RemoteError.prototype.constructor=RemoteError,RemoteError.prototype.name="RemoteError",Object.freeze({RemoteError:RemoteError,encode:encode,decode:decode})}),Esquire.define("rodosha/proxy",["defers/Promise"],function(a){function b(b,c,d){var e=null;this.asProxy=function(a){if(null!=e)throw new Error("Message already sent");return void 0===a&&(a=!0),a&&(b.makeProxy=!0),this},this.initialValue=function(){return d},this.then=function(d,f){try{null==e&&(e=c(b))}catch(g){e=a.reject(g)}return e.then(d,f)}}function c(a,d,e,f){if(!d)throw new Error("No name proxying definition "+JSON.stringify(a));if(Array.isArray(d)||(d=[d]),"object"!=typeof a)throw new Error("Wrong proxy definition at "+d.join(".")+" for \n"+JSON.stringify(f,null,1));if(a.__$$invocable$$__===!0){var g=d.slice(0);return function(){var a={proxy:{proxy:g,arguments:arguments}};return new b(a,e)}}var h={};for(var i in a)!function(g){var i=a[g],j=d.slice(0);j.push(g);var k={enumerable:!0,configurable:!1};if(i.__$$invocable$$__===!0)k.value=c(i,j,e,f);else if(i.hasOwnProperty("__$$value$$__")){var l=i.__$$value$$__;k.get=function(){var a={proxy:{proxy:j}},c=new b(a,e,l);return c.asProxy=function(){return c},c.then(function(a){l=a}),c},k.set=function(a){l=a,e({proxy:{value:a,proxy:j}}).then(function(a){l=a})}}else{if("object"!=typeof i)throw new Error("Wrong proxy definition at "+d.join(".")+" for \n"+JSON.stringify(f,null,1));k.value=c(i,j,e,f)}Object.defineProperty(h,g,k)}(i);return h}function d(a,b){var d=c(a.definition,[a.id],b.send,a.definition);return Object.defineProperty(d,"$$proxyId$$",{enumerable:!1,configurable:!1,value:a.id})}return b.prototype.catch=function(a){return this.then(null,a)},Object.freeze({buildProxy:d})}),Esquire.define("rodosha/servers",["defers/Promise","defers/Deferred","rodosha/messages","rodosha/proxy"],function(a,b,c,d){return Object.freeze({create:function(e,f,g){var h=0,i={},j={},k=Object.freeze({get worker(){return e},get modules(){return Object.keys(j)},init:function(a){for(var b in a)j[a[b]]=!0;return this},send:function(a){if(!e)throw new Error("Worker "+f+" unavailable");var d=new b;return a.id=h++,a=c.encode(a),i[a.id]=d,g&&console.log("Sending to Worker["+f+"]\n"+JSON.stringify(a,null,2)),e.postMessage(a),d.promise},received:function(a){if(a=c.decode(a),g&&console.log("Received from Worker["+f+"]\n"+JSON.stringify(a,null,2)),"console"in a&&(a.arguments.unshift("Worker["+f+"]"),console[a.console].apply(console,a.arguments)),"id"in a){var b=a.id,e=i[b];if(e)try{delete i[b],a.hasOwnProperty("proxy")?e.resolve(d.buildProxy(a.proxy,this)):a.hasOwnProperty("resolve")?e.resolve(a.resolve===!0?a.undefined===!0?void 0:a.null===!0?null:!0:a.resolve):a.hasOwnProperty("reject")?(g&&console.warn("Rejected message "+b,a),e.reject(a.reject)):(console.warn("Invalid message data "+b,a),e.reject(new Error("Invalid message data")))}catch(h){e.reject(h)}else console.error("Unknown message ID",b)}},close:function(){return e?this.send({close:!0}).then(function(a){return k.terminate(new Error("Worker "+f+" closed")),a}):a.resolve()},terminate:function(a){if(e){e.terminate(),e=null,a=a||new Error("Worker "+f+" terminated");for(var b in i){var c=i[b];delete i[b],c.reject(a)}}},"import":function(){for(var b={},c=Esquire.$$normalize(arguments).arguments,d=0;d<c.length;d++){var e=c[d],f=Esquire.module(e);if(!f)throw new Error("Module '"+e+"' not defined");b[e]=f;var g=Esquire.resolve(f,!0);for(var h in g){var i=g[h];b[i.name]=i}}var k=[];for(var e in b)j[e]||b[e].$$dynamic||k.push(b[e]);var l=[];for(var d in k)l.push(this.send({module:k[d]}).then(function(a){return j[a]=!0,a}));return a.all(l)},proxy:function(a){return this.import(a).then(function(){return k.send({require:a,makeProxy:!0})})},destroy:function(a){if(a&&a.$$proxyId$$)return this.send({destroy:a.$$proxyId$$});throw new Error("Invalid proxy object "+a)}});return k}})}),Esquire.define("rodosha/workers",["$global/Worker","$global/Blob","$global/BlobBuilder","$global/URL"],function(a,b,c,d){function e(a,d){Array.isArray(a)||(a=[a]),d||(d="application/javascript");try{return new b(a,{type:d})}catch(e){if(!c)throw e;var f=new c;for(var g in a)f.append(a[g]);return f.getBlob("application/javascript")}}function f(a,c){return a instanceof b?d.createObjectURL(a,c):d.createObjectURL(e(a))}function g(b,c){return new a("string"==typeof b&&b.match(/^blob:/)?b:f(b,c))}if(!a)throw new Error("Worker API not supported");if(!b)throw new Error("Blobs API not supported");if(!d||!d.createObjectURL)throw new Error("Object URLs not supported");return Object.freeze({makeWorker:g,makeBlob:e,makeURL:f})})}({},function(){return this}());
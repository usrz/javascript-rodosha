!function(exports,global){"use strict";global["true"]=exports,Esquire.define("rodosha/client",["$global","$esquire","rodosha/messages"],function(a,b,c){function d(a,b){if(b||(b=[]),"function"==typeof a)return!0;if(a&&"object"==typeof a&&!Array.isArray(a)){if(b.indexOf(a)>=0)throw new TypeError("Unable to proxy object: circular reference detected");b.push(a);var c={};for(var e in a)c[e]=d(a[e],b);return b.pop(),c}return!1}function e(a){if("object"==typeof a&&!Array.isArray(a)||"function"==typeof a){var b="proxy_"+ ++h;g[b]=a;var c=d(a);return{proxy:{id:b,definition:c}}}return{resolve:a}}function f(a){var b=a.data.id;if(null==b)throw new Error("No ID for message "+JSON.stringify(a.data));this.data=c.decode(a.data),this.id=this.data.id}var g={},h=0;return f.prototype.accept=function(b){if(b&&"function"==typeof b.then){var d=this;b.then(function(a){d.accept(a)},function(a){d.reject(a)})}else if(void 0!==b){var f=this.data.makeProxy?e(b):{resolve:c.encode(b)};f.id=this.id,a.postMessage(f)}else a.postMessage({id:this.id,resolve:!0})},f.prototype.reject=function(b){a.postMessage({id:this.id,reject:c.encode(b)})},Object.freeze({init:function(d){var e=a.console={error:function(){a.postMessage({console:"error",arguments:c.encode(arguments)})},warn:function(){a.postMessage({console:"warn",arguments:c.encode(arguments)})},log:function(){a.postMessage({console:"log",arguments:c.encode(arguments)})},info:function(){a.postMessage({console:"info",arguments:c.encode(arguments)})},debug:d?function(){a.postMessage({console:"debug",arguments:c.encode(arguments)})}:function(){},clear:function(){}};a.onmessage=function(c){var d=new f(c);d.foo&&e.log("FOO IS",d.foo);try{if(d.data.module){var h=d.data.module;Esquire.modules[h.name]?e.warn("Module '"+h.name+"' already defined"):(e.debug("Module '"+h.name+"' defined successfully"),Esquire.define(h)),d.accept(Esquire.module(h.name).name)}else if(d.data.require)d.accept(b.require(d.data.require));else if(d.data.proxy){var i=d.data.proxy,j=g,k=null,l=null;for(var m in i.proxy){var n=i.proxy[m];if(!(n in j))throw new Error("Proxy '"+i.proxy.join(".")+"' not found");k=j,l=n,j=j[n]}d.accept("function"==typeof j?j.apply(k,i.arguments):i.value?k[l]=i.value:j)}else if(d.data.destroy)d.data.destroy in g?(delete g[d.data.destroy],d.accept()):d.reject();else{if(!d.data.close)throw new Error("Usupported message: "+JSON.stringify(c.data));a.close(),d.accept()}}catch(o){d.reject(o)}},e.log("Initialized worker thread from "+a.location.href),a.postMessage({initialized:Object.keys(Esquire.modules)})}})}),Esquire.define("rodosha",["promize/Deferred","rodosha/servers","rodosha/workers"],function(a,b,c){return Object.freeze({create:function(d){for(var e=Math.floor(4294967296*Math.random()).toString(16);e.length<8;)e="0"+e;var f=new a,g=[];if(g.push("("+Esquire.$$script+")(self);\n"),g.push(Esquire.module("rodosha/messages").$$script+";\n"),g.push(Esquire.module("rodosha/client").$$script+";\n"),g.push("new Esquire().require('rodosha/client').init("+d+");\n"),d){var h=g.join("").split("\n");for(var i in h){var j=new Number(i)+1;j=10>j?"  "+j+" - ":100>j?" "+j+" - ":j+" - ",h[i]=j+h[i]}console.log("Worker["+e+"] Script\n"+h.join("\n"))}var k=b.create(c.makeWorker(g),e,d),l=Object.freeze({"import":function(){return k["import"].apply(k,arguments)},proxy:function(){return k.proxy.apply(k,arguments)},destroy:function(){return k.destroy.apply(k,arguments)},close:function(){return k.close.apply(k,arguments)},terminate:function(){return k.terminate.apply(k,arguments)}});return k.worker.onerror=function(a){console.error("Worker["+e+"] Uncaught exception",a.data),f.reject(a)},k.worker.onmessage=function(a){if("initialized"in a.data)k.init(a.data.initialized),f.resolve(l);else try{k.received(a.data)}catch(b){console.error("Worker["+e+"] Exception processing message",a.data,b),console.error(b.stack)}},f.promise}})}),Esquire.define("rodosha/messages",[],function messages(){function RemoteError(a){var b=a.message||"Unknown error",c="RemoteError"+(a.name?"["+a.name+"]":"");Error.call(b),this.message=b,this.name=c,this.toString=function(){return c+": "+b};var d=this.stack||(new Error).stack;if(d&&(d=d.replace(/^(Remote)?Error\n/,"")),a.stack||d){var e=this.toString();a.stack&&(e+="\n- Remote stack:\n"+a.stack),d&&(e+="\n- Local stack:\n"+d),this.stack=e}}function copy(a,b,c,d){if(c.indexOf(a)>=0)throw new TypeError("Unable to (en|de)code object: circular reference detected");if(c.push(a),a.hasOwnProperty("callee")&&"number"==typeof a.length)for(var e=0;e<a.length;e++)b[e]=d(a[e],c);else for(var e in a)b[e]=d(a[e],c);return c.pop(),b}function encode(a,b){if(b||(b=[]),void 0===a)return void 0;if(null===a)return null;var c=typeof a;if("undefined"===c)return void 0;if("boolean"===c)return a;if("number"===c)return a;if("string"===c)return a;if("function"===c)return{__$$function$$__:a.toString()};if("object"===c){if(a instanceof ArrayBuffer)return a;if(a.buffer instanceof ArrayBuffer)return a;if(Array.isArray(a))return copy(a,[],b,encode);if(a.hasOwnProperty("callee")&&"number"==typeof arguments.length)return copy(a,[],b,encode);if(a instanceof Error){var d=a.name||Object.getPrototypeOf(a).name,e=a.message,b=a.stack,f={};return d&&(f.name=d),e&&(f.message=e),b&&(f.stack=b),{__$$error$$__:f}}return copy(a,{},b,encode)}return{__$$typeof$$__:c}}function decode(encoded,stack){if(stack||(stack=[]),void 0===encoded)return void 0;if(null===encoded)return null;var type=typeof encoded;if("undefined"===type)return void 0;if("boolean"===type)return encoded;if("number"===type)return encoded;if("string"===type)return encoded;if("object"===type)return encoded instanceof ArrayBuffer?encoded:encoded.buffer instanceof ArrayBuffer?encoded:Array.isArray(encoded)?copy(encoded,[],stack,decode):null!=encoded.__$$error$$__?new RemoteError(encoded.__$$error$$__):null!=encoded.__$$function$$__?eval("("+encoded.__$$function$$__+")"):copy(encoded,{},stack,decode);throw new TypeError("Error decoding "+type+": "+JSON.stringify(encoded))}return RemoteError.prototype=Object.create(Error.prototype),RemoteError.prototype.constructor=RemoteError,RemoteError.prototype.name="RemoteError",Object.freeze({RemoteError:RemoteError,encode:encode,decode:decode})}),Esquire.define("rodosha/proxy",["promize/Promise"],function(a){function b(b,c){var d=null;this.asProxy=function(a){if(null!=d)throw new Error("Message already sent");return void 0===a&&(a=!0),a&&(b.makeProxy=!0),this},this.then=function(e,f){try{null==d&&(d=c(b))}catch(g){d=a.reject(g)}return d.then(e,f)}}function c(a,d,e){if(!d)throw new Error("No name proxying definition "+JSON.stringify(a));if(Array.isArray(d)||(d=[d]),"object"==typeof a){var f=Object.defineProperty({},"$$proxyId$$",{enumerable:!1,configurable:!1,value:d[0]});for(var g in a)!function(b){var g=a[b],h=d.slice(0);h.push(b);var i={enumerable:!0,configurable:!1};"object"==typeof g?i.get=function(){return c(g,h,e)}:g===!0?i.value=c(g,h,e):(i.get=function(){return e({proxy:{proxy:h}})},i.set=function(a){e({proxy:{value:a,proxy:h}})}),Object.defineProperty(f,b,i)}(g);return f}if(a===!0){var h=d.slice(0);return function(){var a={proxy:{proxy:h,arguments:arguments}};return new b(a,e)}}throw new Error("Wrong proxy definition for ",d)}function d(a,b){var d=c(a.definition,[a.id],b.send);return Object.defineProperty(d,"$$proxyId$$",{enumerable:!1,configurable:!1,value:a.id})}return b.prototype.catch=function(a){return this.then(null,a)},Object.freeze({buildProxy:d})}),Esquire.define("rodosha/servers",["promize/Promise","promize/Deferred","rodosha/messages","rodosha/proxy"],function(a,b,c,d){return Object.freeze({create:function(e,f,g){var h=0,i={},j={},k=Object.freeze({worker:e,init:function(a){for(var b in a)j[a[b]]=!0;return this},send:function(a){if(!e)throw new Error("Worker "+f+" unavailable");var d=new b;return a.id=h++,a=c.encode(a),i[a.id]=d,g&&console.log("Sending to Worker["+f+"]\n"+JSON.stringify(a,null,2)),e.postMessage(a),d.promise},received:function(a){if(a=c.decode(a),g&&console.log("Received from Worker["+f+"]\n"+JSON.stringify(a,null,2)),"console"in a&&(a.arguments.unshift("Worker["+f+"]"),console[a.console].apply(console,a.arguments)),"id"in a){var b=a.id,e=i[b];e?(delete i[b],a.hasOwnProperty("proxy")?e.resolve(d.buildProxy(a.proxy,this)):a.hasOwnProperty("resolve")?e.resolve(a.resolve):a.hasOwnProperty("reject")?(g&&console.warn("Rejected message "+b,a),e.reject(a.reject)):(console.warn("Invalid message data "+b,a),e.reject(new Error("Invalid message data")))):console.error("Unknown message ID",b)}},close:function(){return e?this.send({close:!0}).then(function(){k.terminate(new Error("Worker "+f+" closed"))}):a.resolve()},terminate:function(a){if(e){e.terminate(),e=null,a=a||new Error("Worker "+f+" terminated");for(var b in i){var c=i[b];delete i[b],c.reject(a)}}},"import":function(){for(var b={},c=Esquire.$$normalize(arguments).arguments,d=0;d<c.length;d++){var e=c[d],f=Esquire.module(e);if(!f)throw new Error("Module '"+e+"' not defined");b[e]=f;var g=Esquire.resolve(f,!0);for(var h in g){var i=g[h];b[i.name]=i}}var k=[];for(var e in b)j[e]||k.push(b[e]);var l=[];for(var d in k)l.push(this.send({module:k[d]}).then(function(a){return j[a]=!0,a}));return a.all(l)},proxy:function(a){return this.import(a).then(function(){return k.send({require:a,makeProxy:!0})})},destroy:function(a){if(a&&a.$$proxyId$$)return this.send({destroy:a.$$proxyId$$});throw new Error("Invalid proxy object "+a)}});return k}})}),Esquire.define("rodosha/workers",["$global/Worker","$global/Blob","$global/BlobBuilder","$global/URL"],function(a,b,c,d){function e(a,d){Array.isArray(a)||(a=[a]),d||(d="application/javascript");try{return new b(a,{type:d})}catch(e){if(!c)throw e;var f=new c;for(var g in a)f.append(a[g]);return f.getBlob("application/javascript")}}function f(a,c){return a instanceof b?d.createObjectURL(a,c):d.createObjectURL(e(a))}function g(b,c){return new a("string"==typeof b&&b.match(/^blob:/)?b:f(b,c))}if(!a)throw new Error("Worker API not supported");if(!b)throw new Error("Blobs API not supported");if(!d||!d.createObjectURL)throw new Error("Object URLs not supported");return Object.freeze({makeWorker:g,makeBlob:e,makeURL:f})})}({},function(){return this}());
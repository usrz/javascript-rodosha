!function(exports,global){"use strict";global["true"]=exports,Esquire.define("rodosha/client",["$global","$esquire","rodosha/messages"],function(a,b,c){function d(a,b){if(b||(b=[]),a&&("object"==typeof a||"function"==typeof a)&&!Array.isArray(a)){if(b.indexOf(a)>=0)throw new TypeError("Unable to proxy object: circular reference detected");var c={};"function"==typeof a&&(c["!$invocable$!"]=!0),b.push(a);for(var e in a)c[e]=d(a[e],b);return b.pop(),c}return{"!$value$!":a}}function e(a){if("object"==typeof a&&!Array.isArray(a)||"function"==typeof a){var b=c.addProxy(a),e=d(a);return{proxy:{id:b,definition:e}}}return{resolve:a}}function f(a){var b=a.data.id;if(null==b)throw new Error("No ID for message "+JSON.stringify(a.data));this.data=c.decode(a.data),this.id=this.data.id}return f.prototype.accept=function(b){try{if(b&&"function"==typeof b.then){var d=this;b.then(function(a){d.accept(a)},function(a){d.reject(a)})}else if(void 0===b)a.postMessage({id:this.id,resolve:!0,undefined:!0});else if(null===b)a.postMessage({id:this.id,resolve:!0,"null":!0});else{var f=this.data.makeProxy?e(b):{resolve:c.encode(b)};f.id=this.id,a.postMessage(f)}}catch(g){a.postMessage({id:this.id,reject:c.encode(g)})}},f.prototype.reject=function(b){a.postMessage({id:this.id,reject:c.encode(b)})},Object.freeze({init:function(d){var e=a.console={error:function(){a.postMessage({console:"error",arguments:c.encode(arguments)})},warn:function(){a.postMessage({console:"warn",arguments:c.encode(arguments)})},log:function(){a.postMessage({console:"log",arguments:c.encode(arguments)})},info:function(){a.postMessage({console:"info",arguments:c.encode(arguments)})},debug:d?function(){a.postMessage({console:"debug",arguments:c.encode(arguments)})}:function(){},clear:function(){}};a.onmessage=function(d){var g=new f(d);try{if(g.data.module){var h=g.data.module;Esquire.modules[h.name]?e.warn("Module '"+h.name+"' already defined"):(e.debug("Module '"+h.name+"' defined successfully"),Esquire.define(h)),g.accept(h.name)}else if(g.data.require)g.accept(b.require(g.data.require));else if(g.data.proxy){var i=g.data.proxy,j=c.proxies,k=null,l=null;for(var m in i.proxy){var n=i.proxy[m];if(!(n in j))throw new Error("Proxy '"+i.proxy.join(".")+"' not found");k=j,l=n,j=j[n]}g.accept("function"==typeof j?g.data.newInstance===!0?function(a,b){function c(){a.apply(this,b)}return c.prototype=a.prototype,new c}(j,i.arguments):j.apply(k,i.arguments):i.value?k[l]=i.value:j)}else if(g.data.destroy)c.deleteProxy(g.data.destroy);else{if(!g.data.close)throw new Error("Usupported message: "+JSON.stringify(d.data));a.close(),g.accept()}}catch(o){g.reject(o)}},e.log("Initialized worker thread from "+a.location.href),a.postMessage({initialized:Object.keys(Esquire.modules)})}})}),Esquire.define("rodosha",["$deferred","rodosha/servers","rodosha/workers","rodosha/utils"],function(a,b,c,d){return Object.freeze({create:function(){for(var e=Math.floor(4294967296*Math.random()).toString(16);e.length<8;)e="0"+e;var f=new a,g=!1,h=!1,i=arguments.length;arguments.length>0&&"boolean"==typeof arguments[arguments.length-1]&&("boolean"==typeof arguments[arguments.length-2]?(h=arguments[arguments.length-1],g=arguments[arguments.length-2],i-=2):(g=arguments[arguments.length-1],i-=1));for(var j=["rodosha/client"],k=0;i>k;k++)j.push(arguments[k]);return d.resolve(j).then(function(a){var d=[];d.push("("+Esquire.$$script+")(self);\n");for(var i in a)d.push(a[i].$$script+";\n");if(d.push("new Esquire().require('rodosha/client').then(function(client) { client.init("+g+") });\n"),h){var j=d.join("").split("\n");for(var i in j){var k=new Number(i)+1;k=10>k?"  "+k+" - ":100>k?" "+k+" - ":k+" - ",j[i]=k+j[i]}console.log("Worker["+e+"] Script\n"+j.join("\n"))}var l=b.create(c.makeWorker(d),e,g),m=Object.freeze({get modules(){return l.modules},"import":function(){return l["import"].apply(l,arguments)},proxy:function(){return l.proxy.apply(l,arguments)},destroy:function(){return l.destroy.apply(l,arguments)},close:function(){return l.close.apply(l,arguments)},terminate:function(){return l.terminate.apply(l,arguments)}});return l.worker.onerror=function(a){console.error("Worker["+e+"] Uncaught exception",a.message);var b=new Error(a.message);b.event=a,f.reject(b)},l.worker.onmessage=function(a){if("initialized"in a.data)l.init(a.data.initialized),f.resolve(m);else try{l.received(a.data)}catch(b){console.error("Worker["+e+"] Exception processing message",a.data,b),console.error(b.stack)}},f.promise})}})}),Esquire.define("rodosha/messages",["$global/process","$global/Buffer","$global/ArrayBuffer","$global/DataView","$global/Int8Array","$global/Uint8Array","$global/Int16Array","$global/Uint16Array","$global/Int32Array","$global/Uint32Array","$global/Float32Array","$global/Uint8ClampedArray","$global/Float64Array"],function messages(process,Buffer,ArrayBuffer,DataView,Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Uint8ClampedArray,Float64Array){function transferDate(a){return nativeTransfers?a:{"!$native$!":{Date:a.getTime()}}}function transferRegExp(a){return nativeTransfers?a:{"!$native$!":{RegExp:a.toString()}}}function decodeArrayBuffer(a){return process&&Buffer&&null!=a["!$base64$!"]?new Uint8Array(new Buffer(a["!$base64$!"],"base64")).buffer:new Uint8Array(a).buffer}function encodeArrayBuffer(a){if(a instanceof Uint8Array||(a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),process&&Buffer)return{"!$base64$!":new Buffer(a).toString("base64")};for(var b=new Array(a.length),c=0;c<a.length;c++)b[c]=a[c];return b}function receiveNative(object){if("undefined"===object)return void 0;if("NaN"===object)return 0/0;if(object.Date)return new Date(object.Date);if(object.RegExp)return eval(object.RegExp);if(object.ArrayBuffer)return decodeArrayBuffer(object.ArrayBuffer);if(object.Int8Array)return new Int8Array(decodeArrayBuffer(object.Int8Array));if(object.Uint8Array)return new Uint8Array(decodeArrayBuffer(object.Uint8Array));if(object.Int16Array)return new Int16Array(decodeArrayBuffer(object.Int16Array));if(object.Uint16Array)return new Uint16Array(decodeArrayBuffer(object.Uint16Array));if(object.Int32Array)return new Int32Array(decodeArrayBuffer(object.Int32Array));if(object.Uint32Array)return new Uint32Array(decodeArrayBuffer(object.Uint32Array));if(object.Float32Array)return new Float32Array(decodeArrayBuffer(object.Float32Array));if(object.Uint8ClampedArray)return new Uint8ClampedArray(decodeArrayBuffer(object.Uint8ClampedArray));if(object.Float64Array)return new Float64Array(decodeArrayBuffer(object.Float64Array));throw new Error("Unknown native object "+JSON.stringify(object))}function encodeBufferOrView(a){if(nativeTransfers)return a;if(a instanceof ArrayBuffer)return{"!$native$!":{ArrayBuffer:encodeArrayBuffer(new Uint8Array(a))}};if(a instanceof Int8Array)return{"!$native$!":{Int8Array:encodeArrayBuffer(a)}};if(a instanceof Uint8Array)return{"!$native$!":{Uint8Array:encodeArrayBuffer(a)}};if(a instanceof Int16Array)return{"!$native$!":{Int16Array:encodeArrayBuffer(a)}};if(a instanceof Uint16Array)return{"!$native$!":{Uint16Array:encodeArrayBuffer(a)}};if(a instanceof Int32Array)return{"!$native$!":{Int32Array:encodeArrayBuffer(a)}};if(a instanceof Uint32Array)return{"!$native$!":{Uint32Array:encodeArrayBuffer(a)}};if(a instanceof Float32Array)return{"!$native$!":{Float32Array:encodeArrayBuffer(a)}};if(a instanceof Uint8ClampedArray)return{"!$native$!":{Uint8ClampedArray:encodeArrayBuffer(a)}};if(a instanceof Float64Array)return{"!$native$!":{Float64Array:encodeArrayBuffer(a)}};throw new Error("Unable to encode ArrayBuffer or TypedArray (wrong type)")}function isBufferOrView(a){return a instanceof ArrayBuffer?!0:ArrayBuffer.isView?ArrayBuffer.isView(a):DataView&&a instanceof DataView?!0:Int8Array&&a instanceof Int8Array?!0:Uint8Array&&a instanceof Uint8Array?!0:Int16Array&&a instanceof Int16Array?!0:Uint16Array&&a instanceof Uint16Array?!0:Int32Array&&a instanceof Int32Array?!0:Uint32Array&&a instanceof Uint32Array?!0:Float32Array&&a instanceof Float32Array?!0:Uint8ClampedArray&&a instanceof Uint8ClampedArray?!0:Float64Array&&a instanceof Float64Array?!0:!1}function RemoteError(a){var b=a.message||"Unknown error",c="RemoteError"+(a.name?"["+a.name+"]":"");Error.call(b),this.message=b,this.name=c,this.toString=function(){return c+": "+b};var d=this.stack||(new Error).stack;if(d&&(d=d.replace(/^(Remote)?Error\n/,"")),a.stack||d){var e=this.toString();a.stack&&(e+="\n- Remote stack:\n"+a.stack),d&&(e+="\n- Local stack:\n"+d),this.stack=e}}function toUint8Array(a){if(a instanceof Uint8Array)return a;if(Array.isArray(a))return new Uint8Array(a);if("byteOffset"in a&&"byteLength"in a){for(var b=new Array(a.byteLength),c=0;c<a.byteLength;c++)b[c]=a[c+a.byteOffset];return new Uint8Array(b)}throw new Error("Unable to create Uint8Array")}function addProxy(a,b){if(null==a)throw new Error("Unable to proxy null object");if(a.hasOwnProperty("!$proxyId$!"))return a["!$proxyId$!"];if(b||(b="proxy_"+ ++lastProxyId),Object.defineProperty(a,"!$proxyId$!",{enumerable:!1,configurable:!1,value:b}),a["!$proxyId$!"]!=b)throw new Error("Unable to set proxy ID "+b+" on object instance (frozen?)");return proxies[b]=a,b}function getProxy(a){if(proxies.hasOwnProperty(a))return proxies[a];throw new Error("Unkwnown proxy: "+proxyId)}function deleteProxy(a){if(proxies.hasOwnProperty(a))return delete proxies[a],a;if(a.hasOwnProperty("!$proxyId$!")){var b=a["!$proxyId$!"];return delete proxies[b],b}throw new Error("Can't delete unkwnown proxy: "+proxyId)}function copy(a,b,c,d){if(c.indexOf(a)>=0)throw new TypeError("Unable to (en|de)code object: circular reference detected");if(c.push(a),a.hasOwnProperty("callee")&&"number"==typeof a.length)for(var e=0;e<a.length;e++)b[e]=d(a[e],c);else for(var e in a)b[e]=d(a[e],c);return c.pop(),b}function encode(a,b){if(b||(b=[]),void 0===a)return transferableUndefined;if(null===a)return null;var c=typeof a;if("boolean"===c)return a;if("string"===c)return a;if("function"===c)return{"!$function$!":a.toString()};if("number"===c)return isNaN(a)?transferableNotANumber:a;if("object"===c){if(a.hasOwnProperty("!$proxyId$!"))return{"!$proxyId$!":a["!$proxyId$!"]};if(isBufferOrView(a))return encodeBufferOrView(a);if(a instanceof Date)return transferDate(a);if(a instanceof RegExp)return transferRegExp(a);if(a instanceof Error){var d=a.name||Object.getPrototypeOf(a).name,e=a.message,b=a.stack,f={};return d&&(f.name=d),e&&(f.message=e),b&&(f.stack=b),{"!$error$!":f}}return a.hasOwnProperty("callee")&&"number"==typeof a.length||Array.isArray(a)?copy(a,[],b,encode):copy(a,{},b,encode)}throw new Error("Unable to transfer "+c)}function decode(encoded,stack){if(stack||(stack=[]),void 0===encoded)return void 0;if(null===encoded)return null;var type=typeof encoded;if("boolean"===type)return encoded;if("number"===type)return encoded;if("string"===type)return encoded;if("object"===type)return isBufferOrView(encoded)?encoded:encoded instanceof Date?encoded:encoded instanceof RegExp?encoded:null!=encoded["!$error$!"]?new RemoteError(encoded["!$error$!"]):null!=encoded["!$function$!"]?eval("("+encoded["!$function$!"]+")"):null!=encoded["!$native$!"]?receiveNative(encoded["!$native$!"]):null!=encoded["!$proxyId$!"]?getProxy(encoded["!$proxyId$!"]):copy(encoded,encoded,stack,decode);throw new TypeError("Error decoding "+type+": "+JSON.stringify(encoded))}var nativeTransfers=null==process&&null!=ArrayBuffer.isView,transferableUndefined=nativeTransfers?void 0:{"!$native$!":"undefined"},transferableNotANumber=nativeTransfers?0/0:{"!$native$!":"NaN"};RemoteError.prototype=Object.create(Error.prototype),RemoteError.prototype.constructor=RemoteError,RemoteError.prototype.name="RemoteError";var proxies={},lastProxyId=0;return Object.freeze({RemoteError:RemoteError,nativeTransfers:nativeTransfers,proxies:proxies,addProxy:addProxy,getProxy:getProxy,deleteProxy:deleteProxy,encode:encode,decode:decode})}),Esquire.define("rodosha/proxy",["$promise"],function(a){function b(b,c,d){var e=null;this.asProxy=function(a){if(null!=e)throw new Error("Message already sent");return void 0===a&&(a=!0),a&&(b.makeProxy=!0),this},this.initialValue=function(){return d},this.then=function(d,f){try{null==e&&(e=c(b))}catch(g){e=a.reject(g)}return e.then(d,f)},this.catch=function(a){return this.then(null,a)}}function c(a,d,e,f){if(!d)throw new Error("No name proxying definition "+JSON.stringify(a));if(Array.isArray(d)||(d=[d]),"object"!=typeof a)throw new Error("Wrong proxy definition at "+d.join(".")+" for \n"+JSON.stringify(f,null,1));var g={};if(a["!$invocable$!"]===!0){var h=d.slice(0),i=function(){var a={proxy:{proxy:h,arguments:arguments}};return this instanceof i?(a.newInstance=!0,b.call(this,a,e),this.asProxy(!0),void 0):new b(a,e)};g=i}for(var j in a)!function(h){var i=a[h],j=d.slice(0);j.push(h);var k={enumerable:!0,configurable:!1};if(i["!$invocable$!"]===!0)k.value=c(i,j,e,f);else if(i.hasOwnProperty("!$value$!")){var l=i["!$value$!"];k.get=function(){var a={proxy:{proxy:j}},c=new b(a,e,l);return c.asProxy=function(){return c},c.then(function(a){l=a}),c},k.set=function(a){l=a,e({proxy:{value:a,proxy:j}}).then(function(a){l=a})}}else if("object"==typeof i)k.value=c(i,j,e,f);else if("!$invocable$!"!==h)throw new Error("Wrong proxy definition at "+d.join(".")+"."+h+" for \n"+JSON.stringify(f,null,1));Object.defineProperty(g,h,k)}(j);return g}function d(a,b){return c(a.definition,[a.id],b.send,a.definition)}return Object.freeze({buildProxy:d})}),Esquire.define("rodosha/servers",["$promise","$deferred","rodosha/messages","rodosha/proxy","rodosha/utils"],function(a,b,c,d,e){return Object.freeze({create:function(f,g,h){var i=0,j={},k={},l=Object.freeze({get worker(){return f},get modules(){return Object.keys(k)},init:function(a){for(var b in a)k[a[b]]=!0;return this},send:function(a){if(!f)throw new Error("Worker "+g+" unavailable");var d=new b,e=a,k=a.id=i++;if(a=c.encode(a),null==a.id)throw console.warn("PROXIES",c.reverseProxies),new Error("GONZO: "+k+" ->\n"+JSON.stringify(e,null,2)+"\n ->\n"+JSON.stringify(a,null,2));return j[a.id]=d,h&&console.log("Sending to Worker["+g+"]\n"+JSON.stringify(a,null,2)),f.postMessage(a),d.promise},received:function(a){if(a=c.decode(a),h&&console.log("Received from Worker["+g+"]\n"+JSON.stringify(a,null,2)),"console"in a&&(a.arguments.unshift("Worker["+g+"]"),console[a.console].apply(console,a.arguments)),"id"in a){var b=a.id,e=j[b];if(e)try{if(delete j[b],a.hasOwnProperty("proxy")){var f=d.buildProxy(a.proxy,this);c.addProxy(f,a.proxy.id),e.resolve(Object.freeze(f))}else a.hasOwnProperty("resolve")?e.resolve(a.resolve===!0?a.undefined===!0?void 0:a.null===!0?null:!0:a.resolve):a.hasOwnProperty("reject")?(h&&console.warn("Rejected message "+b,a),e.reject(a.reject)):(console.warn("Invalid message data "+b,a),e.reject(new Error("Invalid message data")))}catch(i){e.reject(i)}else console.error("Unknown message ID",b)}},close:function(){return f?this.send({close:!0}).then(function(a){return l.terminate(new Error("Worker "+g+" closed")),a}):a.resolve()},terminate:function(a){if(f){f.terminate(),f=null,a=a||new Error("Worker "+g+" terminated");for(var b in j){var c=j[b];delete j[b],c.reject(a)}}},"import":function(){var b=this;return e.resolve(arguments).then(function(c){var d=[];for(var e in c)k[e]||d.push(c[e]);var f=[];for(var g in d)f.push(b.send({module:d[g]}).then(function(a){return k[a]=!0,a}));return a.all(f)})},proxy:function(a){return this.import(a).then(function(){return l.send({require:a,makeProxy:!0})})},destroy:function(a){var b=c.deleteProxy(a);this.send({destroy:b})}});return l}})}),Esquire.define("rodosha/utils",["$promise"],function(a){function b(a){if(!a)return[];for(var c=[],d=0;d<a.length;d++){var e=a[d];Array.isArray(e)?c=c.concat(b(e)):"object"==typeof e&&"number"==typeof e.length?c=c.concat(b(e)):c.push(e)}return c}function c(){for(var c=[],d=b(arguments),e=0;e<d.length;e++)c.push(Esquire.resolve(d[e],!0,!0));return a.all(c).then(function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];for(var e in d){var f=d[e];f.$$dynamic||(b[e]=d[e])}}return b})}return Object.freeze({flatten:b,resolve:c})}),Esquire.define("rodosha/workers",["$global/Worker","$global/Blob","$global/BlobBuilder","$global/URL"],function(a,b,c,d){function e(a,d){Array.isArray(a)||(a=[a]),d||(d="application/javascript");try{return new b(a,{type:d})}catch(e){if(!c)throw e;var f=new c;for(var g in a)f.append(a[g]);return f.getBlob("application/javascript")}}function f(a,c){return a instanceof b?d.createObjectURL(a,c):d.createObjectURL(e(a))}function g(b,c){return new a("string"==typeof b&&b.match(/^blob:/)?b:f(b,c))}if(!a)throw new Error("Worker API not supported");if(!b)throw new Error("Blobs API not supported");if(!d||!d.createObjectURL)throw new Error("Object URLs not supported");return Object.freeze({makeWorker:g,makeBlob:e,makeURL:f})})}({},function(){return this}());